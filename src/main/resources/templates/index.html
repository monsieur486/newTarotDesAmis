<!DOCTYPE html>
<html lang="fr" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <title th:text="${title}">TDA</title>
    <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/main.css}"/>
    <meta id="logFooter" th:content="${logFooter}"/>
</head>
<body>
<nav class="navbar navbar-dark bg-dark fixed-top">
    <div class="container-fluid align-items-center">
        <a class="navbar-brand mb-0 h1" th:href="@{/}">TDA</a>
        <a class="btn btn-outline-secondary btn-sm" sec:authorize="hasRole('REDACTEUR')" th:href="@{/edit}">Éditer</a>
        <div class="ms-auto d-flex">
            <a class="btn btn-outline-light btn-sm" sec:authorize="!isAuthenticated()" th:href="@{/login}">Login</a>
            <form class="d-inline ms-2 m-0 p-0" method="post" sec:authorize="isAuthenticated()" th:action="@{/logout}">
                <input th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"
                       type="hidden"/>
                <button class="btn btn-outline-warning btn-sm" type="submit">Logout</button>
            </form>
        </div>
    </div>
</nav>

<!-- Marqueur pour le JS: présent uniquement si l'utilisateur a le rôle REDACTEUR -->
<span class="d-none" id="role-redacteur" sec:authorize="hasRole('REDACTEUR')"></span>

<main class="container-fluid pt-3" style="padding-top: 4rem; padding-bottom: 3.5rem;">
    <div class="mb-2 small text-muted">Message courant</div>
    <div class="row g-2">
        <div class="col-12 col-sm-8 col-md-6">
            <div id="c-info"
                 th:class="${currentMessage.level == 0} ? 'form-control text-start text-danger' : 'form-control text-start'"
                 th:with="nb=${(currentMessage.reunion != null and currentMessage.reunion.listeJoueurs != null) ? #lists.size(currentMessage.reunion.listeJoueurs) : 0}">
                <span th:if="${currentMessage.level == 0}">reunion en erreur</span>
                <span th:if="${currentMessage.level == 1}">En attente de joueurs</span>
                <span th:if="${currentMessage.level > 1}" th:text="${nb + ' joueurs'}">4 joueurs</span>
            </div>
        </div>
    </div>
</main>

<footer class="footer fixed-bottom bg-dark text-light py-2 small">
    <div class="container-fluid d-flex justify-content-between align-items-center">
        <div class="text-start text-truncate" id="footer-left"></div>
        <div class="text-end" id="footer-right">
            <span class="ms-2" id="ws-icon" title="État WS">⛓️‍💥</span>
        </div>
    </div>
</footer>

<script crossorigin="anonymous"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="/webjars/sockjs-client/1.5.1/sockjs.min.js"></script>
<script src="/webjars/stomp-websocket/2.3.4/stomp.min.js"></script>
<script src="/js/app.js"></script>
</body>
</html>
